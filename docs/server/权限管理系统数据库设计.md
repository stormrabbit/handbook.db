# 权限管理系统数据库设计 

## 系统结构

- domain 业务逻辑层
- common 通用逻辑层
- entity 数据库

## domain 业务说明

### auth

- 用户登录
- token 鉴定

### user

- 用户列表查询
- 用户详情查询
- 用户信息更新

### role

- 查询角色列表
- 查询角色详情
- 创建角色
- 更新角色信息


### group

- 查询组列表
- 创建组

### assignment

- 查询用户下角色
- 为用户分配角色
- 查询角色下权限
- 为角色分配权限
- 查询组下角色
- 为角色分配组

### endpoint

- 查询权限列表
- 查询权限详情
- 创建权限



#######################################################################################################

2021 年

- 创建数据库

```
    CREATE DATABASE IF NOT EXISTS rebecca DEFAULT CHARSET utf8 COLLATE utf8_general_ci;
```

- 进入数据库

```
    show databases;
    use rebecca;
    show tables;
```

# 用户表

- 创建用户表

```
    drop table if exists users;

    CREATE TABLE IF NOT EXISTS `users`(
   `id` INT UNSIGNED AUTO_INCREMENT,
   `name` VARCHAR(40) NOT NULL,
   `status` TINYINT NOT NULL DEFAULT 0,
   PRIMARY KEY ( `id` )
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```


- 插入一个用户

```
    INSERT INTO users ( name )
                       VALUES
                       ( 'sunny' );
```

- 查看可用用户

```
    select * from users where status <>1;
```

- 更新用户

```
    UPDATE users SET name='杨光' where id=1;
```

- 删除用户

```
    UPDATE users SET status=1 where id=1;
```

# 角色表

- 创建角色表

```
    drop table if exists roles;

    CREATE TABLE IF NOT EXISTS `roles`(
   `id` INT UNSIGNED AUTO_INCREMENT,
   `name` VARCHAR(40) NOT NULL,
   `status` TINYINT NOT NULL DEFAULT 0,
   PRIMARY KEY ( `id` )
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```


- 插入一个角色

```
    INSERT INTO roles ( name )
                       VALUES
                       ( 'admin' );
```

- 查看可用角色

```
    select * from roles where status <>1;
```

- 更新用户

```
    UPDATE roles SET name='超级管理员' where id=1;
```

- 删除用户

```
    UPDATE roles SET status=1 where id=1;
```


# 权限表

- 创建权限表

```
    drop table if exists authorities;

    CREATE TABLE IF NOT EXISTS `authorities`(
   `id` INT UNSIGNED AUTO_INCREMENT,
   `name` VARCHAR(40) NOT NULL,
   `status` TINYINT NOT NULL DEFAULT 0,
   PRIMARY KEY ( `id` )
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```


- 插入权限

```
    INSERT INTO authorities ( name )
                       VALUES
                       ( '管理员' );
    INSERT INTO authorities ( name )
                       VALUES
                       ( '开发者' );
    INSERT INTO authorities ( name )
                       VALUES
                       ( '游客' );
```

- 查看可用权限

```
    select * from authorities where status <>1;
```

- 更新权限

```
    UPDATE authorities SET name='管理员' where id=1;
```

- 删除权限

```
    UPDATE authorities SET status=1 where id=1;
```

# 用户角色关系表

- 创建关系表

```
    drop table if exists user_role_relations;

    CREATE TABLE IF NOT EXISTS `user_role_relations`(
   `id` INT UNSIGNED AUTO_INCREMENT,
   `user_id` INT UNSIGNED NOT NULL,
   `role_id`  INT UNSIGNED NOT NULL,
    `status` TINYINT NOT NULL DEFAULT 0,
   PRIMARY KEY ( `id` )
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

- 创建用户 - 角色关系

```
    INSERT INTO user_role_relations ( user_id,role_id )
                       VALUES
                       ( 1, 1 );
```

- 查看用户 - 角色关系

```
    select * from  user_role_relations where status <> 1
```

- 查看详细的用户角色关系

``` 
    select ur.id id, u.name user_name, r.name role_name from users u,roles r,user_role_relations ur where ur.user_id = u.id and ur.role_id = r.id;
```

# 角色权限关系表

- 创建关系表

```
    drop table if exists role_authority_relations;

    CREATE TABLE IF NOT EXISTS `role_authority_relations`(
   `id` INT UNSIGNED AUTO_INCREMENT,
   `role_id` INT UNSIGNED NOT NULL,
   `authority_id`  INT UNSIGNED NOT NULL,
    `status` TINYINT NOT NULL DEFAULT 0,
   PRIMARY KEY ( `id` )
)ENGINE=InnoDB DEFAULT CHARSET=utf8;
```

- 创建用户 - 角色关系

```
    INSERT INTO role_authority_relations ( role_id,authority_id  )
                       VALUES
                       ( 1, 1 );
  INSERT INTO role_authority_relations ( role_id,authority_id  )
                       VALUES
                       ( 2, 2 );
```

- 查看用户 - 角色关系

```
    select * from  role_authority_relations where status <> 1
```

- 查看详细的用户角色关系

``` 
    select ra.id id, r.name role_name, a.name authority_name from roles r, authorities a,role_authority_relations ra where ra.role_id = r.id and ra.authority_id = a.id;
```

## 查询三者的关系

- 方案一

```
    select  u.name user_name, r.name role_name, a.name authority_name from users u,roles r,authorities a, user_role_relations ur,role_authority_relations ra where ra.role_id = r.id and ra.authority_id = a.id and  ur.user_id = u.id and ur.role_id = r.id;
```

- 方案二

```
    select 
```

